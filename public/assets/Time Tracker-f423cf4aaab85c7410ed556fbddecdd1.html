<!DOCTYPE html>
<!-- saved from url=(0035)http://localhost:3000/welcome/index -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Time Tracker</title>
		<script src="./Time Tracker_files/jquery.min.js"></script>
    <script src="./Time Tracker_files/jquery-ui.js"></script>      
     <link rel="stylesheet" href="https://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">  
      <script src="./Time Tracker_files/jquery.js"></script>
<script src="./Time Tracker_files/jquery_ujs.js"></script>
<script src="./Time Tracker_files/bootstrap.js"></script>
<script src="./Time Tracker_files/application.js"></script>
<script src="./Time Tracker_files/admin.js"></script>
<script src="./Time Tracker_files/advanced.js"></script>
<script src="./Time Tracker_files/attachment.js"></script>
<script src="./Time Tracker_files/authentications.js"></script>
<script src="./Time Tracker_files/bootstrap-wysihtml5.js"></script>
<script src="./Time Tracker_files/carts.js"></script>
<script src="./Time Tracker_files/examples.js"></script>
<script src="./Time Tracker_files/identities.js"></script>
<script src="./Time Tracker_files/jquery-1.10.2.js"></script>
<script src="./Time Tracker_files/jquery-dateFormat.js"></script>
<script src="./Time Tracker_files/jquery-ias.min.js"></script>
<script src="./Time Tracker_files/jquery-ui-1.10.4.custom.js"></script>
<script src="./Time Tracker_files/jquery.fittext.js"></script>
<script src="./Time Tracker_files/jquery.grid-a-licious.js"></script>
<script src="./Time Tracker_files/messi.js"></script>
<script src="./Time Tracker_files/new_tests.js"></script>
<script src="./Time Tracker_files/project_data.js"></script>
<script src="./Time Tracker_files/projects.js"></script>
<script src="./Time Tracker_files/report.js"></script>
<script src="./Time Tracker_files/work_order_admin.js"></script>
<script src="./Time Tracker_files/work_orders.js"></script>
<script src="./Time Tracker_files/jquery.qtip.js"></script>
<script src="./Time Tracker_files/dropzone.js"></script>
<script src="./Time Tracker_files/jquery.cookie.js"></script>
<script src="./Time Tracker_files/jsapi"></script>
      <link href="http://localhost:3000/assets/jquery.qtip.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/application.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/admin.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/attachment.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/bootstrap-wysihtml5.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/bootstrap.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/bootstrap.min.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/custom.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/examples.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/home_page.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/homepage.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/identities.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/jquery-ui-1.10.4.custom.min.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/jquery-ui.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/jquery.countdown.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/jquery.signaturepad.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/jquery.ui.all.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/jquery.ui.base.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/jquery.ui.core.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/jquery.ui.datepicker.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/jquery.ui.theme.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/login.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/main.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/messi.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/new_tests.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/newpetition.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/payments.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/petitions.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/photos.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/posts.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/profile.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/project_data.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/registrations.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/report.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/scaffolds.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/sessions.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/signatures.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/social_buttons.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/static_pages.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/statuses.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/styles.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/texts.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/users.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/welcome.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/work_order_admin.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/work_orders.css?body=1" media="all" rel="stylesheet">
<link href="http://localhost:3000/assets/dropzone/dropzone.css?body=1" media="all" rel="stylesheet">
      <meta content="authenticity_token" name="csrf-param">
<meta content="OrhXtSbw8h9OXOl/+W+gVQU47bouSOdCk3YB3wYVlgE=" name="csrf-token">
      
<!--[if lt IE 9]>
  <script type="text/javascript">
    var html5 = { 'elements': 'abbr article aside audio bdi data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video' };
  </script>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
 <script>
  
  /* ajax setup for csrf token */
  $.ajaxSetup({
      headers: {
        'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
      }
    });
  
  
  
   /*------ Grab colors from Report Controller------- */
   

   function grabColors() {
    $.ajax({
  		async: false,
        method: 'GET',
		url: '/project_colors',
        dateType: 'json',
        success: function(data){
        	var empty = [];
			$.each(data, function (key, value) { 
				empty.push([key, value]);
				
			});
			colorHash = empty;
		        }
    });
    }
    
     function assignColors(array) {
    	var colors = [];
    	$(array).each(function(i, value){
    		$(colorHash).each(function(j, obj) {
    			if ($.inArray(value[0], obj) != -1){
    				colors.push(obj[1]);
    			}
    		});
    	});
    	return colors;
    }
    
    
    google.load("visualization", "1", {packages:["corechart"]});
    //google.setOnLoadCallback(drawChart);
	var pieArray;
	var colorArray;
	
    var  currentBannerClass = 'alert-info';


    /*------- Create Google Pie Chart with date from pieChart trigger -----*/
    function createPieChart(pieHash) {
    	if (pieHash != 'blank'){
    	pieArray = [['Project Title', 'Hours']];
    	colorArray = assignColors(pieHash);
    	pieArray = $.merge(pieArray, pieHash);
    	drawChart(false);	
    	}
    	else {
    		drawChart(true);
    	}
	
	}
          	
      	function drawChart(blank) {
      		if (blank == false){
        		var data = google.visualization.arrayToDataTable(pieArray);
       		 	var options = {
        			colors: colorArray,
        			chartArea: {width: 1000, height:150}
       	 		};
			}
			else {
				var data = google.visualization.arrayToDataTable([['header','fake'],['fake', 0]]);
				options = {};
			}
        var chart = new google.visualization.PieChart(document.getElementById('piechart'));

        chart.draw(data, options);
        
        
       
      }          	
	function overrideAlertBanner(msg, type) {
		var delayTime = 0;
		if (msg== '' && type == '') {
			if (currentBannerClass === 'alert-error') {
				delayTime = 0;
			}
			else {
				delayTime = 3000;
			}
			setTimeout(function() {
			$('.alert').last().hide();
			}, delayTime);
		}
		else {
			delayTime = 0;
			if ($('.alert').length > 1) {
				delayTime = 3000;
				setTimeout(function() {
				$('.alert').last().remove();
				}, delayTime);
			}
			$('.alertBanner').removeClass(currentBannerClass);    
       		$('.alertBanner').addClass('alert-' + type);
        	$('.alertBanner').html(msg);
        	$('.alertBanner').hide(0).delay(delayTime).show(1);
       		currentBannerClass = 'alert-' + type;
       		
       }
    }
    
    function lockTodayTimeInput(dates) {
    	var msg = 'You are missing data within the past 3 business days. Please enter in you time for ';
    	dates = dates.reverse();
    	$.each(dates, function(index, value) {
    		var date = new Date(value);
    		date = '<span class="clickAlertDate" id="' + date + '">' + $.format.date(date, "M/d/yy") + '</span>';
    		msg += date;
    		msg += (index == dates.length - 1) ? '. ' : ', ';
    		});
    	overrideAlertBanner(msg, 'error');
	    }
	    
	function validateHours(lastInput) {
    	lastInput = parseFloat(lastInput);   
    	if ((lastInput % 0.25) != 0) {
    		alert('Hourly input must be in increments of .25 (Example: 3:00pm to 4:15pm is 1.25 hours.)');
    		return false;
    	}
    	var sumDayHours = 0.0;  
    	$('.today').each( function() {
    		sumDayHours += parseFloat($(this).val());
    	});
    	if ((sumDayHours) > 24.0) {
    	    alert('Daily hours may not exceed 24.');
    		return false;
    	}
    	else {
    		return true;
    	}
    }

	
</script><script src="./Time Tracker_files/saved_resource" type="text/javascript"></script><link href="./Time Tracker_files/ui+en.css" type="text/css" rel="stylesheet"><script src="./Time Tracker_files/format+en,default+en,ui+en,corechart+en.I.js" type="text/javascript"></script>
	

	<style>
	.customHeight {
		height:10px !important;
		line-height:10px !important;
		vertical-align:middle !important;
  }
		
	.navPill:visited, .navPill, .navPill:hover {
		color:#428bca;
	}
	
	a.downloadSingle:visited {
		color:white;
	}
	
	.flashContainer {
		height: 52px;
	}
	
	.active > .dropdown-toggle:hover, .nav .open .active > a:focus, .nav .open .active > a:hover{
		color: white !important;
		background-color: #428bca !important;
	}

	.nav .open > a, .nav .open > a:hover, .nav .open > a:focus {
		color: #428bca;
	}
	
	.keepBlue {
		background-color: #428bca !important;
	}



.helpButton{
  vertical-align: middle;
		height: 34px !important;
		width: 25px !important;

}

	
	


	</style>
	<link href="./Time Tracker_files/tooltip.css" rel="stylesheet" type="text/css"></head>
<body><div id="_GPL_e6a00_parent_div" style="position: absolute; top: 0px; left: 0px; width: 1px; height: 1px; z-index: 2147483647;"><object type="application/x-shockwave-flash" id="_GPL_e6a00_swf" data="http://cdncache-a.akamaihd.net/items/e6a00/storage.swf?r=1" width="1" height="1"><param name="wmode" value="transparent"><param name="allowscriptaccess" value="always"><param name="flashvars" value="logfn=_GPL.items.e6a00.log&amp;onload=_GPL.items.e6a00.onload&amp;onerror=_GPL.items.e6a00.onerror&amp;LSOName=gpl"></object></div>
      <div class="row">
        <div class="col-xs-12 col-md-6">
            <ul class="nav nav-pills">
                <li class="active"> <a class="navPill keepBlue" href="./Time Tracker_files/Time Tracker.html">Time Input</a>
                </li>
                <li class=""><a class="navPill" href="http://localhost:3000/TimeSummaries">Time Summaries</a></li>
                  <li class=""><a class="blinkedOut navPill" href="http://localhost:3000/submit_report" style="color: white; background-color: rgb(210, 50, 45);">Submit Reports</a></li>
             </ul>
         </div>
         <div class="col-xs-12 col-md-6">
     <ul class="nav nav-pills">
          	<li class="pull-right"><img alt="Questionmark" class="helpButton" src="./Time Tracker_files/questionMark.png"></li>
     	<li class="pull-right"> <a class="navPill" href="http://localhost:3000/signout">Log Out (Ben)</a></li>
 <!-- end admin or work_order_admin check -->
       
 <!-- end manager check -->
    </ul>
    </div>
   
    </div>
     <!-- check if current_user.client -->

<!-- client nav bar -->
          <div style="clear:both">
          </div>

    <div class="col-xs-12 flashContainer">
	<div class="alert alertBanner alert-error">You are missing data within the past 3 business days. Please enter in you time for <span class="clickAlertDate" id="Fri Aug 08 2014 00:00:00 GMT-0500 (CDT)">8/8/14</span>, <span class="clickAlertDate" id="Mon Aug 11 2014 00:00:00 GMT-0500 (CDT)">8/11/14</span>. </div>
    
		<div class="row"> 
              </div>
    </div>
			<div class="container-fluid" id="body">
				<div class="row-fluid" id="whitey">
                                  <!--  -->


  <!-- **************************************************************************** -->
  <!-- DAY FUNCTIONALITY -->
  

      	<!-- FOR FUTURE TABBED TABLE 
      	<ul class="nav nav-tabs" id="product-table">
  <li><a href="#tab1" data-toggle="tab">Time Input</a>
  </li>
  <li><a href="#tab2" data-toggle="tab">Dashboard</a>
  </li>
		</ul> !-->
      	<div class="row">
      <div class="col-xs-12 col-md-6">
      	<div class="scrollT1">
        <form role="dayform" id="dayForm">
        <div class="btn-group btn-group pull-left navGroup2 ">	
  					<button type="button" class="btn btn-default  changeDateTopPrev navButtonNP" value="prevTop">Prev</button>
  					<button type="button" class="btn btn-default  changeDateTop toToday navButtonT" value="today">Today</button>
					<button type="button" class="btn btn-default  changeDateTopNext navButtonNP" value="nextTop">Next</button>
					</div><br>
              	<!-- FOR TABBED TABLE 

        <div class="tab-content">
   			 <div class="tab-pane" id="tab1"> !-->
            <div class="form-group">
                </div><table class="table table-bordered pull-left" id="daytimeTable">
              <thead>
                  <tr>
                    <th>Project</th>
                    <th>Hours</th>
                    <th><input id="txtDate" class="datepicker hasDatepicker"><input class="datePicker hidden" id="altDate"></th>
                    <th><button type="button" class="btn btn-large btn-primary timeLock" id="add" disabled=""><span class="glyphicon glyphicon-plus"></span></button></th>	
                  </tr>
                </thead>
              <tbody>
                  
                

<script type="text/javascript">

	



    $(".save-btn").click(function(){
        input =  $(this);
        var todayValue = $("#txtDate").val();
        var ip1 = input.parent().prev().children('input');
        var sp1 = input.parent().prev().prev().children('select');
        var hd1 = input.parent().prev().prev().children('input');
        
        if(input.attr('value') == "Edit"){
          input.attr('value', "Save");
          ip1.attr('disabled',false);
          sp1.attr('disabled',false);
        }
        else{
          if(ip1.val() == '' || ip1.val() == undefined){
            alert("Please enter the no. of hours");
            return false;
          }
          if(sp1.val() == '' || sp1.val() == undefined){
            alert("Please select the project");
            return false;
          }
          if (validateHours(ip1.val()) == false) {
          	return false;
          }
          var svC = confirm("Are you sure want to save the changes?");
          if(svC == true){
            var hrs = ip1.val();
            var prj = sp1.val();
            dataStr = "project=" + prj + "&today=" + todayValue + "&hours=" + hrs + "&id="+ hd1.val();
            $.ajax({
              method: 'POST',
              url: '/saveDayTimesheets',
              data : dataStr,
              success: function(dt){
                alert(dt.msg);
                ip1.prop('disabled', true);
                sp1.prop('disabled', true);
                input.attr('value','Edit');
                hd1.val(dt.id);
				reloadPieProject();
				checkPrevDays();
              }
            });
          }
        }
      });

    $(".remove-btn").click(function(){
      		var input = $(this);
      		var table = document.getElementById("daytimeTable");
       	 	var noOfRows = table.rows.length;
       	 	var hd1 = input.parent().prev().prev().prev().children('input');
 			var ip1 = input.parent().prev().prev().children();
        	var sp1 = input.parent().prev().prev().prev().children('select');
        	
            if(hd1.val() == '' || hd1.val()== "" || hd1.val() == undefined){
            	if(noOfRows > 2){
			    	input.parents("tr").remove();
			    }

            }
            else{
              var svC = confirm("Are you sure want to delete?");
	          if(svC == true){
              dataStr = "id="+hd1.val();
              $.ajax({
                method: 'POST',
                url: '/deleteDayTimesheets',
                data : dataStr,
                success: function(dt){
                  alert(dt.msg);
                  reloadPieProject();
                  if(dt.deleted == true)
                  	if (noOfRows > 2) {
                    	input.parents("tr").remove();
                    }
                    else {
                        ip1.val('');
						sp1.val('');
						hd1.val('');
						input.parent().prev().children().attr('value', "Save");
						ip1.attr('disabled',false);
          				sp1.attr('disabled',false);
                    }
					checkPrevDays();
                }
              });
            }
          }
        });
    	function reloadPieProject() {
    	$('.projectTable').trigger('change');
		$('.pieChart').trigger('change');
    }

    $('.project').each(function() {
        $(this).data('lastValue', $(this).val());
    });

    $(".project").change(function(){
          select_box_old_val = $(this).data("lastValue");
          select_box_new_val = $(this).val();
          exist = false;
          console.log(select_box_old_val);
          $('.project').not(this).each(function(){
            if(exist == false){
              console.log(select_box_new_val);
              if($(this).val() == select_box_new_val){
                //select_box.val(select_box.data("lastVal"));
                exist = true;
                alert("There is already timesheet for the selected project.You can update that one");
              }
            }
          });
          if(exist == true){
            $(this).val($(this).data("lastValue"));
          }
          else{
            $(this).data("lastValue",$(this).val());
          }
        });
   
      
        
    
        

</script>  

<script type="text/javascript">

	



    $(".save-btn").click(function(){
        input =  $(this);
        var todayValue = $("#txtDate").val();
        var ip1 = input.parent().prev().children('input');
        var sp1 = input.parent().prev().prev().children('select');
        var hd1 = input.parent().prev().prev().children('input');
        
        if(input.attr('value') == "Edit"){
          input.attr('value', "Save");
          ip1.attr('disabled',false);
          sp1.attr('disabled',false);
        }
        else{
          if(ip1.val() == '' || ip1.val() == undefined){
            alert("Please enter the no. of hours");
            return false;
          }
          if(sp1.val() == '' || sp1.val() == undefined){
            alert("Please select the project");
            return false;
          }
          if (validateHours(ip1.val()) == false) {
          	return false;
          }
          var svC = confirm("Are you sure want to save the changes?");
          if(svC == true){
            var hrs = ip1.val();
            var prj = sp1.val();
            dataStr = "project=" + prj + "&today=" + todayValue + "&hours=" + hrs + "&id="+ hd1.val();
            $.ajax({
              method: 'POST',
              url: '/saveDayTimesheets',
              data : dataStr,
              success: function(dt){
                alert(dt.msg);
                ip1.prop('disabled', true);
                sp1.prop('disabled', true);
                input.attr('value','Edit');
                hd1.val(dt.id);
				reloadPieProject();
				checkPrevDays();
              }
            });
          }
        }
      });

    $(".remove-btn").click(function(){
      		var input = $(this);
      		var table = document.getElementById("daytimeTable");
       	 	var noOfRows = table.rows.length;
       	 	var hd1 = input.parent().prev().prev().prev().children('input');
 			var ip1 = input.parent().prev().prev().children();
        	var sp1 = input.parent().prev().prev().prev().children('select');
        	
            if(hd1.val() == '' || hd1.val()== "" || hd1.val() == undefined){
            	if(noOfRows > 2){
			    	input.parents("tr").remove();
			    }

            }
            else{
              var svC = confirm("Are you sure want to delete?");
	          if(svC == true){
              dataStr = "id="+hd1.val();
              $.ajax({
                method: 'POST',
                url: '/deleteDayTimesheets',
                data : dataStr,
                success: function(dt){
                  alert(dt.msg);
                  reloadPieProject();
                  if(dt.deleted == true)
                  	if (noOfRows > 2) {
                    	input.parents("tr").remove();
                    }
                    else {
                        ip1.val('');
						sp1.val('');
						hd1.val('');
						input.parent().prev().children().attr('value', "Save");
						ip1.attr('disabled',false);
          				sp1.attr('disabled',false);
                    }
					checkPrevDays();
                }
              });
            }
          }
        });
    	function reloadPieProject() {
    	$('.projectTable').trigger('change');
		$('.pieChart').trigger('change');
    }

    $('.project').each(function() {
        $(this).data('lastValue', $(this).val());
    });

    $(".project").change(function(){
          select_box_old_val = $(this).data("lastValue");
          select_box_new_val = $(this).val();
          exist = false;
          console.log(select_box_old_val);
          $('.project').not(this).each(function(){
            if(exist == false){
              console.log(select_box_new_val);
              if($(this).val() == select_box_new_val){
                //select_box.val(select_box.data("lastVal"));
                exist = true;
                alert("There is already timesheet for the selected project.You can update that one");
              }
            }
          });
          if(exist == true){
            $(this).val($(this).data("lastValue"));
          }
          else{
            $(this).data("lastValue",$(this).val());
          }
        });
   
      
        
    
        

</script>  

<script type="text/javascript">

	



    $(".save-btn").click(function(){
        input =  $(this);
        var todayValue = $("#txtDate").val();
        var ip1 = input.parent().prev().children('input');
        var sp1 = input.parent().prev().prev().children('select');
        var hd1 = input.parent().prev().prev().children('input');
        
        if(input.attr('value') == "Edit"){
          input.attr('value', "Save");
          ip1.attr('disabled',false);
          sp1.attr('disabled',false);
        }
        else{
          if(ip1.val() == '' || ip1.val() == undefined){
            alert("Please enter the no. of hours");
            return false;
          }
          if(sp1.val() == '' || sp1.val() == undefined){
            alert("Please select the project");
            return false;
          }
          if (validateHours(ip1.val()) == false) {
          	return false;
          }
          var svC = confirm("Are you sure want to save the changes?");
          if(svC == true){
            var hrs = ip1.val();
            var prj = sp1.val();
            dataStr = "project=" + prj + "&today=" + todayValue + "&hours=" + hrs + "&id="+ hd1.val();
            $.ajax({
              method: 'POST',
              url: '/saveDayTimesheets',
              data : dataStr,
              success: function(dt){
                alert(dt.msg);
                ip1.prop('disabled', true);
                sp1.prop('disabled', true);
                input.attr('value','Edit');
                hd1.val(dt.id);
				reloadPieProject();
				checkPrevDays();
              }
            });
          }
        }
      });

    $(".remove-btn").click(function(){
      		var input = $(this);
      		var table = document.getElementById("daytimeTable");
       	 	var noOfRows = table.rows.length;
       	 	var hd1 = input.parent().prev().prev().prev().children('input');
 			var ip1 = input.parent().prev().prev().children();
        	var sp1 = input.parent().prev().prev().prev().children('select');
        	
            if(hd1.val() == '' || hd1.val()== "" || hd1.val() == undefined){
            	if(noOfRows > 2){
			    	input.parents("tr").remove();
			    }

            }
            else{
              var svC = confirm("Are you sure want to delete?");
	          if(svC == true){
              dataStr = "id="+hd1.val();
              $.ajax({
                method: 'POST',
                url: '/deleteDayTimesheets',
                data : dataStr,
                success: function(dt){
                  alert(dt.msg);
                  reloadPieProject();
                  if(dt.deleted == true)
                  	if (noOfRows > 2) {
                    	input.parents("tr").remove();
                    }
                    else {
                        ip1.val('');
						sp1.val('');
						hd1.val('');
						input.parent().prev().children().attr('value', "Save");
						ip1.attr('disabled',false);
          				sp1.attr('disabled',false);
                    }
					checkPrevDays();
                }
              });
            }
          }
        });
    	function reloadPieProject() {
    	$('.projectTable').trigger('change');
		$('.pieChart').trigger('change');
    }

    $('.project').each(function() {
        $(this).data('lastValue', $(this).val());
    });

    $(".project").change(function(){
          select_box_old_val = $(this).data("lastValue");
          select_box_new_val = $(this).val();
          exist = false;
          console.log(select_box_old_val);
          $('.project').not(this).each(function(){
            if(exist == false){
              console.log(select_box_new_val);
              if($(this).val() == select_box_new_val){
                //select_box.val(select_box.data("lastVal"));
                exist = true;
                alert("There is already timesheet for the selected project.You can update that one");
              }
            }
          });
          if(exist == true){
            $(this).val($(this).data("lastValue"));
          }
          else{
            $(this).data("lastValue",$(this).val());
          }
        });
   
      
        
    
        

</script>  

<script type="text/javascript">

	



    $(".save-btn").click(function(){
        input =  $(this);
        var todayValue = $("#txtDate").val();
        var ip1 = input.parent().prev().children('input');
        var sp1 = input.parent().prev().prev().children('select');
        var hd1 = input.parent().prev().prev().children('input');
        
        if(input.attr('value') == "Edit"){
          input.attr('value', "Save");
          ip1.attr('disabled',false);
          sp1.attr('disabled',false);
        }
        else{
          if(ip1.val() == '' || ip1.val() == undefined){
            alert("Please enter the no. of hours");
            return false;
          }
          if(sp1.val() == '' || sp1.val() == undefined){
            alert("Please select the project");
            return false;
          }
          if (validateHours(ip1.val()) == false) {
          	return false;
          }
          var svC = confirm("Are you sure want to save the changes?");
          if(svC == true){
            var hrs = ip1.val();
            var prj = sp1.val();
            dataStr = "project=" + prj + "&today=" + todayValue + "&hours=" + hrs + "&id="+ hd1.val();
            $.ajax({
              method: 'POST',
              url: '/saveDayTimesheets',
              data : dataStr,
              success: function(dt){
                alert(dt.msg);
                ip1.prop('disabled', true);
                sp1.prop('disabled', true);
                input.attr('value','Edit');
                hd1.val(dt.id);
				reloadPieProject();
				checkPrevDays();
              }
            });
          }
        }
      });

    $(".remove-btn").click(function(){
      		var input = $(this);
      		var table = document.getElementById("daytimeTable");
       	 	var noOfRows = table.rows.length;
       	 	var hd1 = input.parent().prev().prev().prev().children('input');
 			var ip1 = input.parent().prev().prev().children();
        	var sp1 = input.parent().prev().prev().prev().children('select');
        	
            if(hd1.val() == '' || hd1.val()== "" || hd1.val() == undefined){
            	if(noOfRows > 2){
			    	input.parents("tr").remove();
			    }

            }
            else{
              var svC = confirm("Are you sure want to delete?");
	          if(svC == true){
              dataStr = "id="+hd1.val();
              $.ajax({
                method: 'POST',
                url: '/deleteDayTimesheets',
                data : dataStr,
                success: function(dt){
                  alert(dt.msg);
                  reloadPieProject();
                  if(dt.deleted == true)
                  	if (noOfRows > 2) {
                    	input.parents("tr").remove();
                    }
                    else {
                        ip1.val('');
						sp1.val('');
						hd1.val('');
						input.parent().prev().children().attr('value', "Save");
						ip1.attr('disabled',false);
          				sp1.attr('disabled',false);
                    }
					checkPrevDays();
                }
              });
            }
          }
        });
    	function reloadPieProject() {
    	$('.projectTable').trigger('change');
		$('.pieChart').trigger('change');
    }

    $('.project').each(function() {
        $(this).data('lastValue', $(this).val());
    });

    $(".project").change(function(){
          select_box_old_val = $(this).data("lastValue");
          select_box_new_val = $(this).val();
          exist = false;
          console.log(select_box_old_val);
          $('.project').not(this).each(function(){
            if(exist == false){
              console.log(select_box_new_val);
              if($(this).val() == select_box_new_val){
                //select_box.val(select_box.data("lastVal"));
                exist = true;
                alert("There is already timesheet for the selected project.You can update that one");
              }
            }
          });
          if(exist == true){
            $(this).val($(this).data("lastValue"));
          }
          else{
            $(this).data("lastValue",$(this).val());
          }
        });
   
      
        
    
        

</script>    

<script type="text/javascript">

	



    $(".save-btn").click(function(){
        input =  $(this);
        var todayValue = $("#txtDate").val();
        var ip1 = input.parent().prev().children('input');
        var sp1 = input.parent().prev().prev().children('select');
        var hd1 = input.parent().prev().prev().children('input');
        
        if(input.attr('value') == "Edit"){
          input.attr('value', "Save");
          ip1.attr('disabled',false);
          sp1.attr('disabled',false);
        }
        else{
          if(ip1.val() == '' || ip1.val() == undefined){
            alert("Please enter the no. of hours");
            return false;
          }
          if(sp1.val() == '' || sp1.val() == undefined){
            alert("Please select the project");
            return false;
          }
          if (validateHours(ip1.val()) == false) {
          	return false;
          }
          var svC = confirm("Are you sure want to save the changes?");
          if(svC == true){
            var hrs = ip1.val();
            var prj = sp1.val();
            dataStr = "project=" + prj + "&today=" + todayValue + "&hours=" + hrs + "&id="+ hd1.val();
            $.ajax({
              method: 'POST',
              url: '/saveDayTimesheets',
              data : dataStr,
              success: function(dt){
                alert(dt.msg);
                ip1.prop('disabled', true);
                sp1.prop('disabled', true);
                input.attr('value','Edit');
                hd1.val(dt.id);
				reloadPieProject();
				checkPrevDays();
              }
            });
          }
        }
      });

    $(".remove-btn").click(function(){
      		var input = $(this);
      		var table = document.getElementById("daytimeTable");
       	 	var noOfRows = table.rows.length;
       	 	var hd1 = input.parent().prev().prev().prev().children('input');
 			var ip1 = input.parent().prev().prev().children();
        	var sp1 = input.parent().prev().prev().prev().children('select');
        	
            if(hd1.val() == '' || hd1.val()== "" || hd1.val() == undefined){
            	if(noOfRows > 2){
			    	input.parents("tr").remove();
			    }

            }
            else{
              var svC = confirm("Are you sure want to delete?");
	          if(svC == true){
              dataStr = "id="+hd1.val();
              $.ajax({
                method: 'POST',
                url: '/deleteDayTimesheets',
                data : dataStr,
                success: function(dt){
                  alert(dt.msg);
                  reloadPieProject();
                  if(dt.deleted == true)
                  	if (noOfRows > 2) {
                    	input.parents("tr").remove();
                    }
                    else {
                        ip1.val('');
						sp1.val('');
						hd1.val('');
						input.parent().prev().children().attr('value', "Save");
						ip1.attr('disabled',false);
          				sp1.attr('disabled',false);
                    }
					checkPrevDays();
                }
              });
            }
          }
        });
    	function reloadPieProject() {
    	$('.projectTable').trigger('change');
		$('.pieChart').trigger('change');
    }

    $('.project').each(function() {
        $(this).data('lastValue', $(this).val());
    });

    $(".project").change(function(){
          select_box_old_val = $(this).data("lastValue");
          select_box_new_val = $(this).val();
          exist = false;
          console.log(select_box_old_val);
          $('.project').not(this).each(function(){
            if(exist == false){
              console.log(select_box_new_val);
              if($(this).val() == select_box_new_val){
                //select_box.val(select_box.data("lastVal"));
                exist = true;
                alert("There is already timesheet for the selected project.You can update that one");
              }
            }
          });
          if(exist == true){
            $(this).val($(this).data("lastValue"));
          }
          else{
            $(this).data("lastValue",$(this).val());
          }
        });
   
      
        
    
        

</script>  <tr id="lastRow">
    <td class="pHolder">
      <input type="hidden" id="hiddenId" name="hiddenId">
     	<select class="project" id="project" name="project" disabled=""><option value="">Please Select</option>
<option value="17">BLAH</option>
<option value="20">New Project</option>
<option value="12">Test 3</option></select>

    </td>
    <td id="timeLock">
      <input id="today" name="today" type="text" placeholder="Hours" class="today" disabled="">
    </td>
    <td>
      <input type="button" class="btn btn-success save-btn" id="save" value="Save">
    </td>
    <td>
      <input type="button" class="btn btn-large btn-danger remove-btn" id="remove" value="Remove">
    </td>
  </tr>

<script type="text/javascript">

	



    $(".save-btn").click(function(){
        input =  $(this);
        var todayValue = $("#txtDate").val();
        var ip1 = input.parent().prev().children('input');
        var sp1 = input.parent().prev().prev().children('select');
        var hd1 = input.parent().prev().prev().children('input');
        
        if(input.attr('value') == "Edit"){
          input.attr('value', "Save");
          ip1.attr('disabled',false);
          sp1.attr('disabled',false);
        }
        else{
          if(ip1.val() == '' || ip1.val() == undefined){
            alert("Please enter the no. of hours");
            return false;
          }
          if(sp1.val() == '' || sp1.val() == undefined){
            alert("Please select the project");
            return false;
          }
          if (validateHours(ip1.val()) == false) {
          	return false;
          }
          var svC = confirm("Are you sure want to save the changes?");
          if(svC == true){
            var hrs = ip1.val();
            var prj = sp1.val();
            dataStr = "project=" + prj + "&today=" + todayValue + "&hours=" + hrs + "&id="+ hd1.val();
            $.ajax({
              method: 'POST',
              url: '/saveDayTimesheets',
              data : dataStr,
              success: function(dt){
                alert(dt.msg);
                ip1.prop('disabled', true);
                sp1.prop('disabled', true);
                input.attr('value','Edit');
                hd1.val(dt.id);
				reloadPieProject();
				checkPrevDays();
              }
            });
          }
        }
      });

    $(".remove-btn").click(function(){
      		var input = $(this);
      		var table = document.getElementById("daytimeTable");
       	 	var noOfRows = table.rows.length;
       	 	var hd1 = input.parent().prev().prev().prev().children('input');
 			var ip1 = input.parent().prev().prev().children();
        	var sp1 = input.parent().prev().prev().prev().children('select');
        	
            if(hd1.val() == '' || hd1.val()== "" || hd1.val() == undefined){
            	if(noOfRows > 2){
			    	input.parents("tr").remove();
			    }

            }
            else{
              var svC = confirm("Are you sure want to delete?");
	          if(svC == true){
              dataStr = "id="+hd1.val();
              $.ajax({
                method: 'POST',
                url: '/deleteDayTimesheets',
                data : dataStr,
                success: function(dt){
                  alert(dt.msg);
                  reloadPieProject();
                  if(dt.deleted == true)
                  	if (noOfRows > 2) {
                    	input.parents("tr").remove();
                    }
                    else {
                        ip1.val('');
						sp1.val('');
						hd1.val('');
						input.parent().prev().children().attr('value', "Save");
						ip1.attr('disabled',false);
          				sp1.attr('disabled',false);
                    }
					checkPrevDays();
                }
              });
            }
          }
        });
    	function reloadPieProject() {
    	$('.projectTable').trigger('change');
		$('.pieChart').trigger('change');
    }

    $('.project').each(function() {
        $(this).data('lastValue', $(this).val());
    });

    $(".project").change(function(){
          select_box_old_val = $(this).data("lastValue");
          select_box_new_val = $(this).val();
          exist = false;
          console.log(select_box_old_val);
          $('.project').not(this).each(function(){
            if(exist == false){
              console.log(select_box_new_val);
              if($(this).val() == select_box_new_val){
                //select_box.val(select_box.data("lastVal"));
                exist = true;
                alert("There is already timesheet for the selected project.You can update that one");
              }
            }
          });
          if(exist == true){
            $(this).val($(this).data("lastValue"));
          }
          else{
            $(this).data("lastValue",$(this).val());
          }
        });
   
      
        
    
        

</script></tbody>
                
          </table>
          <!-- </div> tab 
    			<div class="tab-pane" id="tab2"> HI OH </div>
    		</div> tab content -->
        </form>
 		  </div>

        </div>

	<div class="col-xs-12 col-md-6"><div class="pieChart center" id="piechart" style="position: relative;"><div dir="ltr" style="position: relative; width: 598px; height: 200px;"><div style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%;"><svg width="598" height="200" aria-label="A chart." style="overflow: hidden;"><defs id="defs"></defs><rect x="0" y="0" width="598" height="200" stroke="none" stroke-width="0" fill="#ffffff"></rect><g></g></svg></div></div><div style="display: none; position: absolute; top: 210px; left: 608px; white-space: nowrap; font-family: Arial; font-size: 12px; font-weight: bold;"></div><div></div></div></div> 
	<div class="col-xs-12"> 
	<div class="scrollT2">
	<div class="btn-group btn-group pull-left navGroup2 ">	
  					<button type="button" class="btn btn-default  changeDateBottomPrev navButtonNP" value="prevBottom">Prev</button>
  					<button type="button" class="btn btn-default toToday navButtonT" value="today">Today</button>
					<button type="button" class="btn btn-default  changeDateBottomNext navButtonNP" value="nextBottom">Next</button>
					</div><br>
 			<div class="form-group"></div><table class="table projectTable currentWeek"><tbody> <tr><td class="cellClick " id="1407733200000">Mon: 8/11/14</td><td class="cellClick todayClass" id="1407819600000">Tue: 8/12/14</td><td class="cellClick " id="1407906000000">Wed: 8/13/14</td><td class="cellClick " id="1407992400000">Thu: 8/14/14</td><td class="cellClick " id="1408078800000">Fri: 8/15/14</td><td class="cellClick " id="1408165200000">Sat: 8/16/14</td><td class="cellClick " id="1408251600000">Sun: 8/17/14</td></tr></tbody></table>
	</div> 
</div>
</div>

<style>


.projectTable{
height:160px !important;
border-bottom: 2px solid #dddddd !important;
border-top: 2px solid #dddddd !important;
}

.table tbody tr:hover td, .table tbody tr:hover th {
    background-color: transparent;
}

.scrollT1 {
	overflow:auto;
	height:250px;
	padding-bottom:0px;
	margin-top:0px;
	margin-bottom:0px !important;
	width: auto;
}	


.scrollT2 {
	overflow:auto;
	width:980px;
	height:100%;
	padding-bottom:0px;
	margin-top:20px !important;
	margin-left: auto;
	margin-right: auto;
}



.btn{
    width:75px !important;
   	padding:0;
	margin:0 !important;
	height:25px !important;
	
}

.navButtonNP{
	width:45px !important;
	font-size:10px !important;
}
.navButtonT{
	width: 50px !important;
	font-size:10px !important;
}

.navGroup1{
	width:45px;
}
.navGroup2{
	margin-bottom:0px;
}

.pTableBtn{
	width:139px !important;
	text-align:left;
	height: 40px !important;
  -webkit-border-radius: 0 !important;
     -moz-border-radius: 0 !important;
          border-radius: 0 !important;
          cursor:default;
}
.pTableInfo{
  width: 100%;
  overflow: hidden;
  white-space: nowrap;
  display: block;
  text-overflow: ellipsis;
  margin-left:2px;
 font-weight: normal;
 font-size: 11px !important;
 font-family: verdana, arial, helvetica, sans serif !important;
}
.project {
	height:25px !important;
	width:300px;
	padding: 0;
}

table {
width:auto !important;
}


th {
padding:3px !important;
font-weight:normal !important;
}

td {
padding:3px !important;
text-align:center !important;

}


.cellClick {
	cursor:default;
	width:141px !important;
	padding:0px !important;
	text-align:left !important;	
}

.cellClick:hover {
	border-top: 2px solid #47a447 !important;
	border-bottom: 2px solid #47a447 !important;
	
}



.today{
	box-sizing: border-box;
	width: 55px;
	height: 25px !important;
	padding:0;
	margin:0 !important;
	}
	
.datepicker {

   	width:90px;
   	padding:0;
	margin:0;
	height:25px;
}

.todayClass {
	border-top: 2px solid #428bca !important;
	border-bottom: 2px solid #428bca;
	
}

.selectedDay {
	border-top: 2px solid #47a447 !important;
	border-bottom: 2px solid #47a447 !important;

}

.clickAlertDate:hover {
	cursor: pointer;
}

</style>




  <!-- Script for day functionality -------------------------------------------------------------------- --->
  <script type="text/javascript">

 function checkPrevDays() {
    	console.log('checkPrev called');
    	$.ajax({
    		url: '/checkPrevTimeSheets',
    		method: 'GET',
    		async: false,
    		dataType: 'json',
    		success: function(data){
    			if (data.empty){
    				lockTimeInput = true;
    				lockTodayTimeInput(data.emptyDays);
    				var calDate = new Date($("#txtDate").val());
					var today = new Date();
					if ((calDate.getDate() >= today.getDate()) && (calDate.getMonth() == today.getMonth())){
						$("#timeLock :input, .timeLock, select#project").prop("disabled", true);
    				}
    			}
    			else {
    				lockTimeInput = false;
    				//$("#timeLock :input, button .timeLock").prop("disabled", false);
					overrideAlertBanner('', '');
				}
    		}
    		});    
    }
     
    $(document).ready(function(){
    
    

     grabColors();
    alertCount = 0;
    var doubleClick = false;
    var doubleClickProject;
	
	function generateSelectBox() {
		usedProjects = [];
		$('.project').each(function() {
			usedProjects.push($(this).val());
		});
	}
   
    
  
    

    
     function dateChange() {
  		$.ajax({
            url: '/load_today_data',
            method: 'GET',
            data : "toDay="+ $("#txtDate").val(),
            async: false,
            success: function(data){
              $("#daytimeTable").find("tr:gt(0)").remove();
              $("#daytimeTable").find("tbody").append(data);
				reloadPieProject();  
				var calDate = new Date($("#txtDate").val());
				var today = new Date();
				if ((calDate.getDate() >= today.getDate()) && (calDate.getMonth() == today.getMonth())){
					if (lockTimeInput == true) {
						$("#timeLock :input, .timeLock, .project").prop("disabled", true);
					}
				}
				else{
						$("#timeLock :input, .timeLock").prop("disabled", false);	
				}
				generateSelectBox();
				if (doubleClick == true) {
					doubleClickEdit();
				}
				
            },
            failure: function(){
              alert("Unable to load the today values.");
            }
          });
    }
	
// Enable arrow keys for hour input 
 	
 $('body').on('keydown', 'input.today', function(event) {
		var input = $(this);
    	if (event.which == 38 || event.which == 104) {
	   		 if (input.val() < 24 ) {
        		input.val((parseInt(input.val()) + 1));
        	}
   		 } 
   		 else if (event.which == 40 || event.which == 98) {
   		 	if (input.val() > 0 ) {
        	input.val((parseInt(input.val()) - 1));
        }
        }
        else  if (event.which == 13){
        	input.closest('tr').find('.save-btn').trigger('click');
			    }
    
	});
	
$('body').on('focus', 'input.today', function() {
	var input = $(this);
	if (input.val() == ''){
		input.val(0);
	}
});
 
 $('body').on('click', 'input.today', function() {
	var input = $(this);
	input.select();
});



var multiKey = {37: false, 39: false, 16: false};
$(document).keydown(function(e) {
    if (e.keyCode in multiKey) {
        multiKey[e.keyCode] = true;
        if (multiKey[37] && multiKey[16]) {
        	$('.changeDateBottomPrev').trigger('click');			

        }
        else if (multiKey[39] && multiKey[16]) {
       	 $('.changeDateBottomNext').trigger('click');
        
        }
         else if (multiKey[39]) {
			$('.changeDateTopNext').trigger('click');			
        }
        else if (multiKey[37]) {
			$('.changeDateTopPrev').trigger('click');			
   		 } 
        
    }
}).keyup(function(e) {
    if (e.keyCode in multiKey) {
        multiKey[e.keyCode] = false;
    }
});

 


      $('.project').each(function() {
        $(this).data('lastValue', $(this).val());
      });
      var months = [ "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December" ];
      var days = {0:"Sun", 1:"Mon", 2:"Tue", 3:"Wed", 4:"Thu", 5:"Fri", 6:"Sat"};
		

    /*------- Input Array of format [[values]] to grab color code from colorHash -----*/

   
     /*------------ Reload Pie Chart and Weekly View -----------------*/

	function reloadPieProject() {
    	$('.projectTable').trigger('change');
		$('.pieChart').trigger('change');
    }
          	
/*------------ Set DatePicker Input -----------------*/
	$("#txtDate").datepicker({ altField:  '#altDate', altFormat: 'yy-mm-dd',showOtherMonths: true, selectOtherMonths: true,
        showOtherMonths: true, selectOtherMonths: true,
        onSelect: function() {
          var selectedDate = $("#txtDate").datepicker('getDate');
          var selectedMonthName = months[selectedDate.getMonth()];
          $("#currentMonth").html(selectedMonthName);
          storedDateWeekly = selectedDate;
          storedDateDaily = selectedDate;
          dateChange();
		  reloadPieProject();
		  today = new Date();
		  if (storedDateDaily.getDate() >= today.getDate()) {
      		checkPrevDays();
      		}
        }
      });
      
      
      
      
      /*------------ Set Global Variables -----------------*/

      $('#txtDate').datepicker('setDate', 'today');
      var toDayDate = $("#txtDate").datepicker('getDate');
      var todayMonthName = months[toDayDate.getMonth()];
      $("#currentMonth").html(todayMonthName);
      var id = 0;
	  storedDateWeekly = toDayDate;
	  storedDateDaily = toDayDate;
	  
	/*------------ Button that brings everything to current date -----------------*/

      $('.toToday').click( function(){
           $('#txtDate').datepicker('setDate', 'today');  
           dateChange();
           storedDateWeekly = new Date();
           storedDateDaily = new Date();
           reloadPieProject();
      });
      
    $('body').on('click', '.clickAlertDate', function() {
      	var date = $(this).attr('id');
      	date = new Date(date);
        $('#txtDate').datepicker('setDate', date);
           storedDateWeekly = date;
           storedDateDaily = date;
           reloadPieProject();
           dateChange();

      });
      
    
	/*------------ 'Prev' and 'Next' Button -----------------*/
	
	$('.changeDateTopNext').click( function() { 
          var changeDay = 0;
          var changeMonth = 0;
          var changeYear = 0;
          changeDay = 1;
          storedDateDaily.setYear(storedDateDaily.getFullYear() + changeYear);	
          storedDateDaily.setMonth(storedDateDaily.getMonth() + changeMonth);	
          storedDateDaily.setDate(storedDateDaily.getDate() + changeDay);
           $('#txtDate').datepicker('setDate', new Date(storedDateDaily) );
           storedDateWeekly = new Date(storedDateDaily);
           dateChange();
	    });
	    
		$('.changeDateTopPrev').click( function() { 
          var changeDay = 0;
          var changeMonth = 0;
          var changeYear = 0;
          changeDay = -1;
          storedDateDaily.setYear(storedDateDaily.getFullYear() + changeYear);	
          storedDateDaily.setMonth(storedDateDaily.getMonth() + changeMonth);	
          storedDateDaily.setDate(storedDateDaily.getDate() + changeDay);
           $('#txtDate').datepicker('setDate', new Date(storedDateDaily) );
           storedDateWeekly = new Date(storedDateDaily);
           dateChange();
	    });
	    
	    
	    
      $('.changeDateBottomNext').click( function() { 
          var changeDay = 0;
          var changeMonth = 0;
          var changeYear = 0;
          changeDay = 7;
          storedDateWeekly.setYear(storedDateWeekly.getFullYear() + changeYear);	
          storedDateWeekly.setMonth(storedDateWeekly.getMonth() + changeMonth);	
          storedDateWeekly.setDate(storedDateWeekly.getDate() + changeDay);
          $('.projectTable').trigger('change');	
	    });
	
	    $('.changeDateBottomPrev').click( function() { 
          var changeDay = 0;
          var changeMonth = 0;
          var changeYear = 0;
          changeDay = -7;
          storedDateWeekly.setYear(storedDateWeekly.getFullYear() + changeYear);	
          storedDateWeekly.setMonth(storedDateWeekly.getMonth() + changeMonth);	
          storedDateWeekly.setDate(storedDateWeekly.getDate() + changeDay);
          $('.projectTable').trigger('change');	
	    });

      

    /*------------ Start of Time Input -----------------*/

     
             
        function removeRow(input){
        	var table = document.getElementById("daytimeTable");
       	 	var noOfRows = table.rows.length;
       	 	var hd1 = input.parent().prev().prev().prev().children('input');
 			var ip1 = input.parent().prev().prev().children();
        	var sp1 = input.parent().prev().prev().prev().children('select');
        	
            if(hd1.val() == '' || hd1.val()== "" || hd1.val() == undefined){
            	if(noOfRows > 2){
			    	input.parents("tr").remove();
			    }

            }
            else{
              var svC = confirm("Are you sure want to delete?");
	          if(svC == true){
              dataStr = "id="+hd1.val();
              $.ajax({
                method: 'POST',
                url: '/deleteDayTimesheets',
                data : dataStr,
                success: function(dt){
                  alert(dt.msg);
                  reloadPieProject();
                  if(dt.deleted == true)
                  	if (noOfRows > 2) {
                    	input.parents("tr").remove();
                    	checkPrevDays();
                    }
                    else {
                        ip1.val('');
						sp1.val('');
						hd1.val('');
						input.parent().prev().children().attr('value', "Save");
						ip1.attr('disabled',false);
          				sp1.attr('disabled',false);
                    	checkPrevDays();
                    	
                    }
                }
              });
            }
          }
        }
        
        function saveRow(input){
        var todayValue = $("#txtDate").val();
        var ip1 = input.parent().prev().children('input');
        var sp1 = input.parent().prev().prev().children('select');
        var hd1 = input.parent().prev().prev().children('input');
        console.log(hd1.val());
        if(input.attr('value') == "Edit"){
          input.attr('value', "Save");
          ip1.attr('disabled',false);
          sp1.attr('disabled',false);
        }
        else{
          if(ip1.val() == '' || ip1.val() == undefined){
            alert("Please enter the no. of hours");
            return false;
          }
          if(sp1.val() == '' || sp1.val() == undefined){
            alert("Please select the project");
            return false;
          }
          if (validateHours(ip1.val()) == false) {
          	return false;
          }
          var svC = confirm("Are you sure want to save the changes?");
          if(svC == true){
            var hrs = ip1.val();
            var prj = sp1.val();
            dataStr = "project=" + prj + "&today=" + todayValue + "&hours=" + hrs + "&id="+ hd1.val();
            console.log(dataStr);
            $.ajax({
              method: 'POST',
              url: '/saveDayTimesheets',
              data : dataStr,
              success: function(dt){
                alert(dt.msg);
                hd1.val(dt.id);
                ip1.prop('disabled', true);
                sp1.prop('disabled', true);
                input.attr('value','Edit');
  				grabColors();
                reloadPieProject();
                checkPrevDays();

              }
            });
          }
        }
        
        
        }
        
        function doubleClickEdit () {
     		$('#daytimeTable').find('select').each( function(ind, value) {
     		if (value.value == doubleClickProject) {
     		$(this).prop('disabled', false);
     		$(this).closest('tr').find('input.today').prop('disabled', false);
     		$(this).closest('tr').find('input.today').focus(); 		
            $(this).closest('tr').find('.save-btn').attr('value', "Save");
     		}
     	});
       	}

        
        function weekSlideDates(value, date){
         		var changeDay = 0;
          		var changeMonth = 0;
          		var changeYear = 0;
          		if (value == 'prev') { changeDay = -7;}
          		else if (value == 'next'){changeDay = 7;}
          		else if (value == 'prevTop') {changeDay = -1;}
          		else if (value == 'nextTop') {changeDay = 1;}
          		date.setYear(storedDateWeekly.getFullYear() + changeYear);	
          		date.setMonth(storedDateWeekly.getMonth() + changeMonth);	
         		date.setDate(storedDateWeekly.getDate() + changeDay);
         		return date;
         	}/* Project Table Creation */

		function weeklyScroll(dataStr, tableClass){
				$.ajax({
          		method: 'GET',
          		data: dataStr,
          		url: '/projectReport',
          		dataType: 'json',
          		success: function(data){
   			     	$(tableClass).find("tr").remove();
						$.each(data, function (i, obj) { 
							var totalHours = new Array();
							if (obj.dates) {
								var firstRow = '<tr>';
							   	$.each(obj.dates, function(i, value) {
							   		var date = new Date(value);
							   		var today = new Date();
							   		var datePicked = $("#txtDate").datepicker('getDate');
							   		var dateColHead = days[date.getDay()] + ": ";
							   		var color = '';
							   		var todayClass ='';
							   		if (today.getDate() == date.getDate()) {
							   			todayClass = 'todayClass';
							   		}
							   		else if (date.getDate() == datePicked.getDate()) {
							   			todayClass = 'selectedDay';
							   		}
							   		firstRow += '<td class="cellClick ' + todayClass + '" id="'+ value + '">' + dateColHead + $.format.date(date, "M/d/yy") + '</td>';
							  });
							   	firstRow += '</tr>';
								$('.projectTable > tbody:last').append(firstRow);   
			    
			    /*------- Enable change date on click -----*/
								$('.cellClick').click(function(event) {
    								var cid = $(this).attr('id');
    								var dateNum = parseInt(cid);
    								newDate = new Date(dateNum);
    								var timer = setTimeout(function() {
    								doubleClick = false;
      								$('#txtDate').datepicker('setDate', newDate);  
      								storedDateDaily = newDate;
      								storedDateWeekly = newDate;
 									dateChange();
									event.preventDefault;
 									}, 250);
 									 $(this).find('button').click(function(event) {
    									doubleClick = true;
    									var selectedProject = $(this).attr('id');     		
    									doubleClickProject = selectedProject;
    									$('#txtDate').datepicker('setDate', newDate);  
      									storedDateDaily = newDate;
      									storedDateWeekly = newDate;
 										dateChange();
										clearTimeout(timer);
										event.preventDefault();
										event.stopPropagation();
    								});
   						 		});
            		}
							else {
            					var projectCount = 0;		
            					$.each(obj, function (key, value) {
            						console.log(obj);
            						var htmlStr = '';
            						$.each(value, function (i, info) {
            							if (info.projectHours && info.projectDate && info.projectHours != '0') {
            								var select = '#' + info.projectDate;
            								if (projectCount == 0) {
							   					htmlStr += '<br /><div class="btn-group-vertical">';
            								}
            								projectClass = info.projectDate + projectCount;
            			
            								var backColor = assignColors([[key]]);
											htmlStr += '<button type="button" class="btn btn-sm btn-default pTableBtn" style="background-color:' + backColor[0] + '; color:#fff;" id="'+info.pid+'"><span class="pTableInfo">'
            											+ key + ' <br />' + info.projectHours + '</span></button>';
            								$(select).append(htmlStr);
            								htmlStr='';
     							            qHtml = key;
     							          projectClass = '.' + projectClass;
            							 /* $(projectClass).qtip({
     							            	content: 	
     							            	{
                                					text:qHtml,
                            					},
                            					position: {
                                   					 my: "bottom left",
                                   					 at: "top left"
                                				},
                                				style: {
                                   					tip: true,
                                    				width: 600,
                                    				classes: "ui-tooltip-dark"
                               					}
                               				}); */
            							
            								projectCount++;	
            								
            								};
            								
            								
            						});
								});
							} 	
							 }); 								
            		},
            	failure: function(){
              		alert("Unable to load the today values.");
           		}
        	});

        	}
       



   /*     $('table').on('dblclick', '.pTableBtn', function(event) {
     		var selectedProject = $(this).attr('id');
    		var cid = $(this).parent().attr('id');
    		var dateNum = parseInt(cid);
    		newDate = new Date(dateNum);
      		$('#txtDate').datepicker('setDate', newDate);  
      		storedDateDaily = newDate;
      		storedDateWeekly = newDate;
 			dateChange();
     		event.preventDefault();
     		doubleClick = true
     		doubleClickProject = selectedProject;
     	});

     */
     $("#add").click(function () {
            generateSelectBox();	
         var master = $(this).parents("#daytimeTable");
        var table = document.getElementById("daytimeTable");
    	var noOfRows = table.rows.length;
    	var noAPs = $('.project:first option').length;
		if (usedProjects.length >= noAPs-1) {
			alert('You have no more Assigned Projects');
		}
		else {
        id++;
        var rowHtml = "<tr id='lastRow'>\n\
                          <td><input type='hidden' id='hiddenId' name='hiddenId' /><select id='project"+ noOfRows +"' name='project' class='project'>\n\
                          <option value=''>Please Select</option> <option value='20'>New Project</option><option value='12'>Test 3</option><option value='17'>BLAH</option></select></td>\n\
                          <td><input id='today timeLock"+ noOfRows +"' name='today' type='text' placeholder='Hours' class='today'/></td>\n\
                          <td><input type='button' class='btn btn-success save-btn' id='save' value='Save'></input></td>\n\
                          <td><input type='button' class='btn btn-large btn-danger remove-btn' id='remove' value='Remove'></input></td> \n\
                      </tr>";
        master.find("tbody").append(rowHtml);
        
        /* ENSURE SELECT BOX is Populated with project values that have not been entered */
        $.each(usedProjects, function(index, value) {
        	if ($('.project:last option[value="' + value +'"]')){
        		$('.project:last option[value="' + value +'"]').remove();
        	}       
        });

        $(".save-btn").last().click(function(){
		  saveRow($(this));
        });
        

        
        $(".remove-btn").last().click(function(){
        	removeRow($(this));        
        });
        
       $(".project").last().change(function(){
          select_box_old_val = $(this).data("lastValue");
          select_box_new_val = $(this).val();
          exist = false;
          console.log(select_box_old_val);
          $('.project').not(this).each(function(){
            if(exist == false){
              console.log(select_box_new_val);
              if($(this).val() == select_box_new_val){
                //select_box.val(select_box.data("lastVal"));
                exist = true;
                alert("Project has already been entered for today.");
              }
            }
          });
          if(exist == true){
            $(this).val($(this).data("lastValue"));
          }
          else{
            $(this).data("lastValue",$(this).val());
          }
        }); 
		}

      });
      
      $(".save-btn").click(function(){
        saveRow($(this));
      });
      $(".remove-btn").click(function(){
         removeRow($(this));        
      });
 

      $(".project").change(function(){
        select_box_old_val = $(this).data("lastValue");
        select_box_new_val = $(this).val();
        exist = false;
        console.log(select_box_old_val);
        $('.project').not(this).each(function(){
          if(exist == false){
            console.log(select_box_new_val);
            if($(this).val() == select_box_new_val){
              //select_box.val(select_box.data("lastVal"));
              exist = true;
              alert("Project has already been entered for today.");
            }
          }
        });
        if(exist == true){
          $(this).val($(this).data("lastValue"));
        }
        else{
          $(this).data("lastValue",$(this).val());
        }
      });       
        
      $('.pieChart').change(function() {
        var todayValue = $("#txtDate").val();
        dataStr = "today=" + todayValue;
        $.ajax({
          method: 'GET',
          async: false,
          data: dataStr,
          url: '/createPieChart',
          dataType: 'json',
          success: function(pieHash){
            var newPieHash = [];
            $.each(pieHash,function( key, value ) {
            	newPieHash.push([key, parseInt(value)]);
              });
            if (1 <= newPieHash.length){
				createPieChart(newPieHash);
          	}
          	else{
				createPieChart('blank');        	}
          }
        });
      });

    /*------- Create Week View at bottom of page -----*/

 $('.projectTable').change( function() {
 			var loopCount = 0;
 			var todayValue = storedDateWeekly;
		  	var viewValue =  'weekly';

			var dataStr = "today=" + todayValue + "&view=" + viewValue;
			if(loopCount == 0 ) {weeklyScroll(dataStr, '.currentWeek');}

/*---------------------- Future scroll functionality -------------------*/
 			/*while (loopCount <3){
         	else if (loopCount == 1) {
         		var newDate = weekSlideDates('prev', todayValue);
         		dataStr = "today=" + newDate + "&view=" + viewValue;
         		weeklyScroll(dataStr, '.before');
         	}
         	else {
         		var newDate = weekSlideDates('next', todayValue);
                dataStr = "today=" + newDate + "&view=" + viewValue;
         		weeklyScroll(dataStr, '.after');
         	}
						
			 loopCount++;
			 }*/
					
		});
		
		

  	$('.pull-down').each(function() {
    	$(this).css('margin-top', $(this).parent().height()-($(this).height() + 20));

	});
	
	//$('body').on('click', '#save, #remove', function () { checkPrevDays();});  	


  	reloadPieProject();
	checkPrevDays();
	generateSelectBox();

	
  });

          
	
	

  </script>


                                </div>
                          </div>
	
        <script>

		
          $(document).ready(function(){
            $.ajaxSetup({
              beforeSend: function(xhr) {
                xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
              }

           
            });
            
                       
                
            
            var colorHash = [];
			
			blinking($('.blink'));
			blinkedOut($('.blinkedOut'));
			
			function blinkedOut(elm) {
				elm.css({backgroundColor:'#d2322d', color: 'white' });
			}
			
			 function quitBlink(elm) {
        		setTimeout( function() {
        			clearInterval(timer);
        			elm.css({backgroundColor:'#d2322d', color: 'white' });
        			}, 3000 );
        	
        	}
			function blinking(elm) {
    			var colors = ['#d2322d', 'white'];
    			var textColors = ['white', '#428bca'];
    			timer = setInterval(blink, 250);
    			quitBlink(elm);
    			var count = 0;
    			function blink() {
    				(count == 0)? count=1:count=0;
    				setTimeout(function() { elm.css({backgroundColor: colors[count]});
    										elm.css({color: textColors[count]});}, 0);
        		}
        		   				elm.css({backgroundColor:'#d2322d', color: 'white' });
        		}
        	
    		  $('.active > a').addClass('keepBlue');		
    		});
   </script>
<div id="ui-datepicker-div" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-header ui-widget-header ui-helper-clearfix ui-corner-all"><a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="Prev"><span class="ui-icon ui-icon-circle-triangle-w">Prev</span></a><a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="Next"><span class="ui-icon ui-icon-circle-triangle-e">Next</span></a><div class="ui-datepicker-title"><span class="ui-datepicker-month">August</span>&nbsp;<span class="ui-datepicker-year">2014</span></div></div><table class="ui-datepicker-calendar"><thead><tr><th class="ui-datepicker-week-end"><span title="Sunday">Su</span></th><th><span title="Monday">Mo</span></th><th><span title="Tuesday">Tu</span></th><th><span title="Wednesday">We</span></th><th><span title="Thursday">Th</span></th><th><span title="Friday">Fr</span></th><th class="ui-datepicker-week-end"><span title="Saturday">Sa</span></th></tr></thead><tbody><tr><td class=" ui-datepicker-week-end ui-datepicker-other-month " data-handler="selectDay" data-event="click" data-month="6" data-year="2014"><a class="ui-state-default ui-priority-secondary" href="http://localhost:3000/welcome/index#">27</a></td><td class=" ui-datepicker-other-month " data-handler="selectDay" data-event="click" data-month="6" data-year="2014"><a class="ui-state-default ui-priority-secondary" href="http://localhost:3000/welcome/index#">28</a></td><td class=" ui-datepicker-other-month " data-handler="selectDay" data-event="click" data-month="6" data-year="2014"><a class="ui-state-default ui-priority-secondary" href="http://localhost:3000/welcome/index#">29</a></td><td class=" ui-datepicker-other-month " data-handler="selectDay" data-event="click" data-month="6" data-year="2014"><a class="ui-state-default ui-priority-secondary" href="http://localhost:3000/welcome/index#">30</a></td><td class=" ui-datepicker-other-month " data-handler="selectDay" data-event="click" data-month="6" data-year="2014"><a class="ui-state-default ui-priority-secondary" href="http://localhost:3000/welcome/index#">31</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">1</a></td><td class=" ui-datepicker-week-end " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">2</a></td></tr><tr><td class=" ui-datepicker-week-end " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">3</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">4</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">5</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">6</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">7</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">8</a></td><td class=" ui-datepicker-week-end " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">9</a></td></tr><tr><td class=" ui-datepicker-week-end " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">10</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">11</a></td><td class=" ui-datepicker-days-cell-over  ui-datepicker-current-day ui-datepicker-today" data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default ui-state-highlight ui-state-active ui-state-hover" href="http://localhost:3000/welcome/index#">12</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">13</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">14</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">15</a></td><td class=" ui-datepicker-week-end " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">16</a></td></tr><tr><td class=" ui-datepicker-week-end " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">17</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">18</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">19</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">20</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">21</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">22</a></td><td class=" ui-datepicker-week-end " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">23</a></td></tr><tr><td class=" ui-datepicker-week-end " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">24</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">25</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">26</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">27</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">28</a></td><td class=" " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">29</a></td><td class=" ui-datepicker-week-end " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">30</a></td></tr><tr><td class=" ui-datepicker-week-end " data-handler="selectDay" data-event="click" data-month="7" data-year="2014"><a class="ui-state-default" href="http://localhost:3000/welcome/index#">31</a></td><td class=" ui-datepicker-other-month " data-handler="selectDay" data-event="click" data-month="8" data-year="2014"><a class="ui-state-default ui-priority-secondary" href="http://localhost:3000/welcome/index#">1</a></td><td class=" ui-datepicker-other-month " data-handler="selectDay" data-event="click" data-month="8" data-year="2014"><a class="ui-state-default ui-priority-secondary" href="http://localhost:3000/welcome/index#">2</a></td><td class=" ui-datepicker-other-month " data-handler="selectDay" data-event="click" data-month="8" data-year="2014"><a class="ui-state-default ui-priority-secondary" href="http://localhost:3000/welcome/index#">3</a></td><td class=" ui-datepicker-other-month " data-handler="selectDay" data-event="click" data-month="8" data-year="2014"><a class="ui-state-default ui-priority-secondary" href="http://localhost:3000/welcome/index#">4</a></td><td class=" ui-datepicker-other-month " data-handler="selectDay" data-event="click" data-month="8" data-year="2014"><a class="ui-state-default ui-priority-secondary" href="http://localhost:3000/welcome/index#">5</a></td><td class=" ui-datepicker-week-end ui-datepicker-other-month " data-handler="selectDay" data-event="click" data-month="8" data-year="2014"><a class="ui-state-default ui-priority-secondary" href="http://localhost:3000/welcome/index#">6</a></td></tr></tbody></table></div></body></html>